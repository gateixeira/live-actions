services:
  app: &app-base
    profiles: ["local"]
    build: .
    image: live-actions:latest
    ports:
      - "${PORT:-8080}:8080"
    volumes:
      - app_data:/app/data
    environment: &app-env
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - PORT=${PORT:-8080}
      - DATABASE_URL=${DATABASE_URL:-/app/data/live-actions.db}
      - GIN_MODE=${GIN_MODE:-release}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - DATA_RETENTION_DAYS=${DATA_RETENTION_DAYS:-30}
      - CLEANUP_INTERVAL_HOURS=${CLEANUP_INTERVAL_HOURS:-24}
      - RUNNER_TYPE_CONFIG_PATH=${RUNNER_TYPE_CONFIG_PATH:-config/runner_types.json}

  app-remote:
    profiles: ["remote"]
    image: ghcr.io/gateixeira/live-actions:${TAG:-latest}
    ports:
      - "${PORT:-8080}:8080"
    volumes:
      - app_data:/app/data
    environment: *app-env

volumes:
  app_data:
